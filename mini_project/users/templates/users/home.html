{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="home-container">

 <!-- Hero Banner -->
<div class="hero-banner">
  <video autoplay loop muted playsinline class="hero-img">
    <source src="{% static 'users/video_hm.mp4' %}" type="video/mp4" />
    Browser kamu tidak support video.
  </video>
  <div class="hero-text">
    <h1>Selamat Datang di Motopartz</h1>
    <p>Temukan part otomotif terbaik untuk performa motor kesayanganmu ðŸš€</p>
  </div>
</div>


  {% if user.is_authenticated %}
    <p class="home-header">Halo, <b>{{ user.username }}</b>! Siap upgrade motor hari ini? ðŸ’¨</p>

    <!-- Kategori -->
    <div class="category-section">
      <h2>Kategori Produk</h2>
      <div class="categories">
        <a href="{% url 'shock' %}" class="cat-card">Shock</a>
        <a href="{% url 'velg' %}" class="cat-card">Velg</a>
        <a href="{% url 'lampu' %}" class="cat-card">Lampu</a>
      </div>
    </div>

    <!-- Produk Populer -->
    <div class="shop">
      <h2 class="section-title">Produk Populer ðŸ”¥</h2>
      <div class="product-grid">
        {% for product in products %}
        <div class="card"
             onclick="openProductPopup('{{ product.id }}',
                                        '{{ product.name|escapejs }}',
                                        '{{ product.description|escapejs }}',
                                        '{{ product.price|floatformat:0|intcomma }}',
                                        '{% if product.image %}{{ product.image.url }}{% else %}{% static 'users/images/dell.jpg' %}{% endif %}')">

          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
          {% else %}
            <img src="{% static 'users/images/dell.jpg' %}" alt="{{ product.name }}">
          {% endif %}

          <h2 class="info-st">{{ product.name }}</h2>
          <p class="desc-st">{{ product.description }}</p>
          <p class="price">Rp {{ product.price|floatformat:0|intcomma }}</p>
        </div>
        {% empty %}
          <p>Tidak ada produk populer.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Popup Produk -->
    <div id="product-popup" class="popup">
      <div class="popup-content">
        <span class="close-btn" onclick="closeProductPopup()">&times;</span>
        <img id="popup-img" src="" alt="Produk" class="popup-img"/>
        <h2 id="popup-title"></h2>
        <p id="popup-desc"></p>
        <p id="popup-price" class="price"></p>

        {% if user.is_authenticated %}
        <form id="popup-form" method="POST">
          {% csrf_token %}
          <button type="submit">Checkout</button>
        </form>
        {% else %}
        <button type="button" class="buy-button"
          onclick="alert('Harus register & login terlebih dahulu sebelum checkout!')">
          Checkout
        </button>
        {% endif %}
      </div>
    </div>

  {% else %}
    <!-- Kalau belum login -->
    <div class="reg-log">
      <div class="logo-container">
        <img src="{% static 'users/logopt.png' %}" alt="Logo Web Karbu/Throttle Body">
      </div>
      <h2>Gabung dengan Kami ðŸš€</h2>
      <p>Silakan <a class="register-home" href="{% url 'register' %}">Register</a> terlebih dahulu untuk melihat produk kami.</p>
      <p>Sudah punya akun? <a class="login-home" href="{% url 'login' %}">Login</a> untuk membeli produk.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
