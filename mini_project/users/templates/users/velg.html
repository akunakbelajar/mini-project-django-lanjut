{% extends "base.html" %}

{% load static %}
{% load humanize %}

{% block title %}Velg{% endblock %}

{% block content %}
<h2 class="home-page">Produk Velg</h2>

<div class="shop">
  {% for velg in velgs %}
  <div class="card"
       onclick="openProductPopup('{{ velg.id }}',
                                  '{{ velg.name|escapejs }}',
                                  '{{ velg.description|escapejs }}',
                                  '{{ velg.price|floatformat:0|intcomma }}',
                                  '{% if velg.image %}{{ velg.image.url }}{% else %}{% static 'users/images/velg-default.jpg' %}{% endif %}')">
    {% if velg.image %}
      <img src="{{ velg.image.url }}" alt="{{ velg.name }}">
    {% else %}
      <img src="{% static 'users/images/velg-default.jpg' %}" alt="{{ velg.name }}">
    {% endif %}

    <h2 class="info-st">{{ velg.name }}</h2>
    <p class="desc-st">{{ velg.description }}</p>
    <p class="price">Rp {{ velg.price|floatformat:0|intcomma }}</p>
  </div>
  {% empty %}
    <p>Tidak ada velg tersedia.</p>
  {% endfor %}
</div>

<!-- Popup Produk -->
<div id="product-popup" class="popup">
  <div class="popup-content">
    <span class="close-btn" onclick="closeProductPopup()">&times;</span>
    <img id="popup-img" src="" alt="Produk" class="popup-img"/>
    <h2 id="popup-title"></h2>
    <p id="popup-desc"></p>
    <p id="popup-price" class="price"></p>

    {% if user.is_authenticated %}
    <form id="popup-form" method="POST">
      {% csrf_token %}
      <button type="submit">Checkout</button>
    </form>
    {% else %}
    <button type="button" class="buy-button"
      onclick="alert('Harus register & login terlebih dahulu sebelum checkout!')">
      Checkout
    </button>
    {% endif %}
  </div>
</div>

{% endblock %}